(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,59544,e=>{"use strict";var t=e.i(43476),i=e.i(932),a=e.i(46932),s=e.i(67062);let n={sm:"h-8 px-3 text-sm rounded-[var(--radius-sm)]",md:"h-10 px-4 text-sm rounded-[var(--radius-md)]",lg:"h-12 px-5 text-base rounded-[var(--radius-lg)]",icon:"h-11 w-11 rounded-[var(--radius-pill)]"},r={glass:"ui-glass text-[hsl(var(--surface-foreground))] hover:bg-[hsl(var(--surface)/0.92)]",primary:"bg-[hsl(var(--accent))] text-[hsl(var(--accent-foreground))] shadow-[0_10px_25px_rgba(236,72,153,0.28)] hover:shadow-[0_14px_30px_rgba(236,72,153,0.35)]",ghost:"bg-transparent text-[hsl(var(--surface-foreground))] hover:bg-[hsl(var(--surface)/0.12)]",danger:"bg-red-500/80 text-white hover:bg-red-600/90 shadow-[0_10px_25px_rgba(239,68,68,0.28)]"};function o(e){let o,l,c,d,h,u,p,m,y,g,v=(0,i.c)(19);v[0]!==e?({className:l,variant:u,size:p,leftIcon:c,rightIcon:h,children:o,...d}=e,v[0]=e,v[1]=o,v[2]=l,v[3]=c,v[4]=d,v[5]=h,v[6]=u,v[7]=p):(o=v[1],l=v[2],c=v[3],d=v[4],h=v[5],u=v[6],p=v[7]);let f=void 0===u?"glass":u,k=void 0===p?"md":p;v[8]===Symbol.for("react.memo_cache_sentinel")?(m={scale:.96},v[8]=m):m=v[8];let x=n[k],b=r[f];return v[9]!==l||v[10]!==x||v[11]!==b?(y=(0,s.cn)("ui-focus-ring inline-flex select-none items-center justify-center gap-2 font-medium transition-[transform,background-color,color,box-shadow,border-color] active:scale-[0.98] disabled:opacity-50 disabled:pointer-events-none",x,b,l),v[9]=l,v[10]=x,v[11]=b,v[12]=y):y=v[12],v[13]!==o||v[14]!==c||v[15]!==d||v[16]!==h||v[17]!==y?(g=(0,t.jsxs)(a.motion.button,{whileTap:m,className:y,...d,children:[c,o,h]}),v[13]=o,v[14]=c,v[15]=d,v[16]=h,v[17]=y,v[18]=g):g=v[18],g}e.s(["Button",()=>o])},61911,e=>{"use strict";let t=(0,e.i(75254).default)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]);e.s(["Users",()=>t],61911)},18087,53339,6062,e=>{"use strict";var t=e.i(75254);let i=(0,t.default)("sofa",[["path",{d:"M20 9V6a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v3",key:"1dgpiv"}],["path",{d:"M2 16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-5a2 2 0 0 0-4 0v1.5a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5V11a2 2 0 0 0-4 0z",key:"xacw8m"}],["path",{d:"M4 18v2",key:"jwo5n2"}],["path",{d:"M20 18v2",key:"1ar1qi"}],["path",{d:"M12 4v9",key:"oqhhn3"}]]);e.s(["Sofa",()=>i],18087);let a=(0,t.default)("music",[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]]);e.s(["Music",()=>a],53339);let s=(0,t.default)("move",[["path",{d:"M12 2v20",key:"t6zp3m"}],["path",{d:"m15 19-3 3-3-3",key:"11eu04"}],["path",{d:"m19 9 3 3-3 3",key:"1mg7y2"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"m5 9-3 3 3 3",key:"j64kie"}],["path",{d:"m9 5 3-3 3 3",key:"l8vdw6"}]]);e.s(["Move",()=>s],6062)},73526,e=>{"use strict";let t=(0,e.i(75254).default)("map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]);e.s(["Map",()=>t],73526)},91741,e=>{"use strict";let t=(0,e.i(75254).default)("clipboard-list",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);e.s(["ClipboardList",()=>t],91741)},73998,e=>{"use strict";let t=(0,e.i(75254).default)("book",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]]);e.s(["Book",()=>t],73998)},39616,68553,30699,59005,e=>{"use strict";var t=e.i(75254);let i=(0,t.default)("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);e.s(["Settings",()=>i],39616);let a=(0,t.default)("camera",[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);e.s(["Camera",()=>a],68553);let s=(0,t.default)("gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]);e.s(["Gift",()=>s],30699);var n=e.i(71645),r=e.i(98688),o=e.i(71929);e.s(["useGiftSystem",0,()=>{let e=(0,n.useRef)(null),{addMessage:t,setIsThinking:i,apiKey:a,activeModels:s,personality:l,messages:c}=(0,r.useStore)(),{playSound:d}=(0,o.useSoundManager)(),h=async(e,n,r)=>{let o={role:"user",content:`I have a gift for you: ${e}`,id:Date.now().toString(),attachment:{type:n,name:e,url:"image"===n?r:void 0,content:"text"===n?r:void 0}};t(o),i(!0);let l=s.length>0?s[0]:null,d=l?l.description||`You are ${l.name}.`:"You are a helpful AI assistant.",h="";h="image"===n?`User sent you an image named "${e}". Since you cannot see it directly yet, pretend you are looking at it. 
        It is a gift for you. React with surprise and happiness. 
        Ask the user what this picture is about or compliment it vaguely (e.g., "Wow, the colors are amazing!").
        Give a suggestion related to images (e.g., "We should frame this!" or "Is this from your trip?").`:"text"===n?`User sent you a text file named "${e}".
        Content snippet:
        """
        ${r}
        """
        
        Read the content above. 
        1. Summarize what you think this is.
        2. Give a specific suggestion or feedback based on the content.
        3. React enthusiastically as if receiving a gift.
        `:`User sent you a file named "${e}". Thank them for the gift and ask what it is inside.`;let u=`
    Instructions:
    - ${d}
    - You just received a GIFT from the user.
    - React appropriately (Happy, Excited, Curious).
    - ${h}
    - Keep replies concise (2-3 sentences).
    - Use [emotion:xxx] and [action:xxx] tags.
    `;try{let e=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:[{role:"system",content:u},...c.slice(-5),o],apiKey:a})}),i=await e.json();i.reply&&t({role:"assistant",content:i.reply,id:(Date.now()+1).toString()})}catch(e){console.error(e),t({role:"assistant",content:"[emotion:sad] [action:cry] 呜呜，礼物好像在传输过程中丢了... (Network Error)",id:(Date.now()+1).toString()})}finally{i(!1)}};return{fileInputRef:e,handleGiftClick:()=>{e.current?.click()},processFile:async e=>{let t=e.target.files?.[0];if(!t)return;e.target.value="",d("click");let i=t.type.startsWith("image/"),a=t.type.startsWith("text/")||t.name.endsWith(".md")||t.name.endsWith(".json")||t.name.endsWith(".js")||t.name.endsWith(".ts");if(i){let e=new FileReader;e.onload=e=>{let i=e.target?.result;h(t.name,"image",i)},e.readAsDataURL(t)}else if(a){let e=new FileReader;e.onload=e=>{let i=e.target?.result,a=i.slice(0,3e3)+(i.length>3e3?"\n...(truncated)":"");h(t.name,"text",a)},e.readAsText(t)}else h(t.name,"file","Binary or unsupported file type")}}}],59005)},11723,e=>{"use strict";var t=e.i(43476),i=e.i(932),a=e.i(98688),s=e.i(46932),n=e.i(88653),r=e.i(59544),o=e.i(39616),l=e.i(61911),c=e.i(73526),d=e.i(91741),h=e.i(73998),u=e.i(18087),p=e.i(68553),m=e.i(53339),y=e.i(6062);let g=(0,e.i(75254).default)("menu",[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]]);var v=e.i(37727),f=e.i(87951),k=e.i(87246),x=e.i(30699),b=e.i(71645),w=e.i(59005);function M(){let e,M,A,S,z,C,T,_,H,N,R,$,U,G,W,B,I,V,O,q,D,F,P,K,L,Y,E=(0,i.c)(86),{activePanel:J,setActivePanel:X,isPhotoMode:Q,togglePhotoMode:Z,bgmPlaying:ee,toggleBgm:et,isEditMode:ei,toggleEditMode:ea,isVoiceEnabled:es,toggleVoiceEnabled:en}=(0,a.useStore)(),{fileInputRef:er,handleGiftClick:eo,processFile:el}=(0,w.useGiftSystem)(),[ec,ed]=(0,b.useState)(!1);if(Q)return null;E[0]!==J||E[1]!==X?(e=()=>X("settings"===J?"none":"settings"),E[0]=J,E[1]=X,E[2]=e):e=E[2];let eh="settings"===J;E[3]!==e||E[4]!==eh?(M={id:"settings",icon:o.Settings,label:"设置",action:e,isActive:eh},E[3]=e,E[4]=eh,E[5]=M):M=E[5],E[6]!==J||E[7]!==X?(A=()=>X("models"===J?"none":"models"),E[6]=J,E[7]=X,E[8]=A):A=E[8];let eu="models"===J;E[9]!==A||E[10]!==eu?(S={id:"models",icon:l.Users,label:"角色",action:A,isActive:eu},E[9]=A,E[10]=eu,E[11]=S):S=E[11],E[12]!==J||E[13]!==X?(z=()=>X("scenes"===J?"none":"scenes"),E[12]=J,E[13]=X,E[14]=z):z=E[14];let ep="scenes"===J;E[15]!==z||E[16]!==ep?(C={id:"scenes",icon:c.Map,label:"场景",action:z,isActive:ep},E[15]=z,E[16]=ep,E[17]=C):C=E[17],E[18]!==J||E[19]!==X?(T=()=>X("tasks"===J?"none":"tasks"),E[18]=J,E[19]=X,E[20]=T):T=E[20];let em="tasks"===J;E[21]!==em||E[22]!==T?(_={id:"tasks",icon:d.ClipboardList,label:"任务",action:T,isActive:em},E[21]=em,E[22]=T,E[23]=_):_=E[23],E[24]!==J||E[25]!==X?(H=()=>X("memories"===J?"none":"memories"),E[24]=J,E[25]=X,E[26]=H):H=E[26];let ey="memories"===J;E[27]!==H||E[28]!==ey?(N={id:"memories",icon:h.Book,label:"记忆",action:H,isActive:ey},E[27]=H,E[28]=ey,E[29]=N):N=E[29],E[30]!==J||E[31]!==X?(R=()=>X("furniture"===J?"none":"furniture"),E[30]=J,E[31]=X,E[32]=R):R=E[32];let eg="furniture"===J;E[33]!==R||E[34]!==eg?($={id:"furniture",icon:u.Sofa,label:"家具",action:R,isActive:eg},E[33]=R,E[34]=eg,E[35]=$):$=E[35],E[36]!==eo?(U={id:"gift",icon:x.Gift,label:"送礼",action:eo,isActive:!1},E[36]=eo,E[37]=U):U=E[37],E[38]!==ee||E[39]!==et?(G={id:"bgm",icon:m.Music,label:"音乐",action:et,isActive:ee},E[38]=ee,E[39]=et,E[40]=G):G=E[40];let ev=es?f.Mic:k.MicOff;E[41]!==es||E[42]!==ev||E[43]!==en?(W={id:"voice",icon:ev,label:"语音",action:en,isActive:es},E[41]=es,E[42]=ev,E[43]=en,E[44]=W):W=E[44],E[45]!==ei||E[46]!==ea?(B={id:"edit",icon:y.Move,label:"编辑",action:ea,isActive:ei},E[45]=ei,E[46]=ea,E[47]=B):B=E[47],E[48]!==Z?(I={id:"photo",icon:p.Camera,label:"拍照",action:Z,isActive:!1},E[48]=Z,E[49]=I):I=E[49],E[50]!==_||E[51]!==N||E[52]!==$||E[53]!==U||E[54]!==G||E[55]!==M||E[56]!==W||E[57]!==B||E[58]!==I||E[59]!==S||E[60]!==C?(V=[M,S,C,_,N,$,U,G,W,B,I],E[50]=_,E[51]=N,E[52]=$,E[53]=U,E[54]=G,E[55]=M,E[56]=W,E[57]=B,E[58]=I,E[59]=S,E[60]=C,E[61]=V):V=E[61];let ef=V,ek=`ui-glass flex items-center overflow-hidden transition-all ${ec?"rounded-[var(--radius-lg)] p-2 gap-2 max-w-[95vw]":"rounded-[var(--radius-pill)] p-2"} shadow-lg`;E[62]!==ec?(O=()=>ed(!ec),E[62]=ec,E[63]=O):O=E[63];let ex=ec?"收起菜单":"展开菜单",eb=ec?"收起菜单":"展开菜单";return E[64]!==ec?(q=ec?(0,t.jsx)(v.X,{size:20}):(0,t.jsx)(g,{size:20}),E[64]=ec,E[65]=q):q=E[65],E[66]!==O||E[67]!==ex||E[68]!==eb||E[69]!==q?(D=(0,t.jsx)(r.Button,{layout:!0,onClick:O,variant:"glass",size:"icon",className:"flex-shrink-0 text-pink-500","aria-label":ex,title:eb,children:q}),E[66]=O,E[67]=ex,E[68]=eb,E[69]=q,E[70]=D):D=E[70],E[71]!==ef||E[72]!==ec?(F=ec&&(0,t.jsx)(s.motion.div,{initial:{opacity:0,width:0},animate:{opacity:1,width:"auto"},exit:{opacity:0,width:0},className:"flex gap-2 overflow-x-auto custom-scrollbar items-center pr-1",children:ef.map(j)}),E[71]=ef,E[72]=ec,E[73]=F):F=E[73],E[74]!==F?(P=(0,t.jsx)(n.AnimatePresence,{children:F}),E[74]=F,E[75]=P):P=E[75],E[76]!==ek||E[77]!==D||E[78]!==P?(K=(0,t.jsx)("div",{className:"pointer-events-auto",children:(0,t.jsxs)(s.motion.div,{layout:!0,initial:!1,className:ek,children:[D,P]})}),E[76]=ek,E[77]=D,E[78]=P,E[79]=K):K=E[79],E[80]!==er||E[81]!==el?(L=(0,t.jsx)("input",{type:"file",ref:er,className:"hidden",onChange:el,accept:"image/*,text/*,.md,.txt,.json,.js,.ts"}),E[80]=er,E[81]=el,E[82]=L):L=E[82],E[83]!==K||E[84]!==L?(Y=(0,t.jsxs)("div",{className:"fixed top-4 left-0 right-0 z-50 flex justify-center md:hidden pointer-events-none",children:[K,L]}),E[83]=K,E[84]=L,E[85]=Y):Y=E[85],Y}function j(e){return(0,t.jsx)(s.motion.button,{layout:!0,whileTap:{scale:.9},onClick:()=>e.action(),className:`ui-focus-ring p-3 rounded-[var(--radius-pill)] flex-shrink-0 transition-all ${e.isActive?"bg-pink-500 text-white shadow-pink-500/30 shadow-md":"bg-white/70 text-gray-700 hover:bg-white/90"}`,title:e.label,"aria-label":e.label,children:(0,t.jsx)(e.icon,{size:20})},e.id)}e.s(["default",()=>M],11723)},34875,e=>{e.n(e.i(11723))}]);