(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,59544,e=>{"use strict";var t=e.i(43476),i=e.i(932),a=e.i(46932),s=e.i(67062);let n={sm:"h-8 px-3 text-sm rounded-[var(--radius-sm)]",md:"h-10 px-4 text-sm rounded-[var(--radius-md)]",lg:"h-12 px-5 text-base rounded-[var(--radius-lg)]",icon:"h-11 w-11 rounded-[var(--radius-pill)]"},r={glass:"ui-glass text-[hsl(var(--surface-foreground))] hover:bg-[hsl(var(--surface)/0.92)]",primary:"bg-[hsl(var(--accent))] text-[hsl(var(--accent-foreground))] shadow-[0_10px_25px_rgba(236,72,153,0.28)] hover:shadow-[0_14px_30px_rgba(236,72,153,0.35)]",ghost:"bg-transparent text-[hsl(var(--surface-foreground))] hover:bg-[hsl(var(--surface)/0.12)]",danger:"bg-red-500/80 text-white hover:bg-red-600/90 shadow-[0_10px_25px_rgba(239,68,68,0.28)]"};function o(e){let o,l,c,u,d,h,p,m,y,g,f=(0,i.c)(19);f[0]!==e?({className:l,variant:h,size:p,leftIcon:c,rightIcon:d,children:o,...u}=e,f[0]=e,f[1]=o,f[2]=l,f[3]=c,f[4]=u,f[5]=d,f[6]=h,f[7]=p):(o=f[1],l=f[2],c=f[3],u=f[4],d=f[5],h=f[6],p=f[7]);let v=void 0===h?"glass":h,x=void 0===p?"md":p;f[8]===Symbol.for("react.memo_cache_sentinel")?(m={scale:.96},f[8]=m):m=f[8];let k=n[x],b=r[v];return f[9]!==l||f[10]!==k||f[11]!==b?(y=(0,s.cn)("ui-focus-ring inline-flex select-none items-center justify-center gap-2 font-medium transition-[transform,background-color,color,box-shadow,border-color] active:scale-[0.98] disabled:opacity-50 disabled:pointer-events-none",k,b,l),f[9]=l,f[10]=k,f[11]=b,f[12]=y):y=f[12],f[13]!==o||f[14]!==c||f[15]!==u||f[16]!==d||f[17]!==y?(g=(0,t.jsxs)(a.motion.button,{whileTap:m,className:y,...u,children:[c,o,d]}),f[13]=o,f[14]=c,f[15]=u,f[16]=d,f[17]=y,f[18]=g):g=f[18],g}e.s(["Button",()=>o])},61911,e=>{"use strict";let t=(0,e.i(75254).default)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]);e.s(["Users",()=>t],61911)},18087,53339,6062,e=>{"use strict";var t=e.i(75254);let i=(0,t.default)("sofa",[["path",{d:"M20 9V6a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v3",key:"1dgpiv"}],["path",{d:"M2 16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-5a2 2 0 0 0-4 0v1.5a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5V11a2 2 0 0 0-4 0z",key:"xacw8m"}],["path",{d:"M4 18v2",key:"jwo5n2"}],["path",{d:"M20 18v2",key:"1ar1qi"}],["path",{d:"M12 4v9",key:"oqhhn3"}]]);e.s(["Sofa",()=>i],18087);let a=(0,t.default)("music",[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]]);e.s(["Music",()=>a],53339);let s=(0,t.default)("move",[["path",{d:"M12 2v20",key:"t6zp3m"}],["path",{d:"m15 19-3 3-3-3",key:"11eu04"}],["path",{d:"m19 9 3 3-3 3",key:"1mg7y2"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"m5 9-3 3 3 3",key:"j64kie"}],["path",{d:"m9 5 3-3 3 3",key:"l8vdw6"}]]);e.s(["Move",()=>s],6062)},73526,e=>{"use strict";let t=(0,e.i(75254).default)("map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]);e.s(["Map",()=>t],73526)},91741,e=>{"use strict";let t=(0,e.i(75254).default)("clipboard-list",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);e.s(["ClipboardList",()=>t],91741)},73998,e=>{"use strict";let t=(0,e.i(75254).default)("book",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]]);e.s(["Book",()=>t],73998)},39616,68553,30699,59005,e=>{"use strict";var t=e.i(75254);let i=(0,t.default)("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);e.s(["Settings",()=>i],39616);let a=(0,t.default)("camera",[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);e.s(["Camera",()=>a],68553);let s=(0,t.default)("gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]);e.s(["Gift",()=>s],30699);var n=e.i(71645),r=e.i(98688),o=e.i(71929);e.s(["useGiftSystem",0,()=>{let e=(0,n.useRef)(null),{addMessage:t,setIsThinking:i,apiKey:a,activeModels:s,personality:l,messages:c}=(0,r.useStore)(),{playSound:u}=(0,o.useSoundManager)(),d=async(e,n,r)=>{let o={role:"user",content:`I have a gift for you: ${e}`,id:Date.now().toString(),attachment:{type:n,name:e,url:"image"===n?r:void 0,content:"text"===n?r:void 0}};t(o),i(!0);let l=s.length>0?s[0]:null,u=l?l.description||`You are ${l.name}.`:"You are a helpful AI assistant.",d="";d="image"===n?`User sent you an image named "${e}". Since you cannot see it directly yet, pretend you are looking at it. 
        It is a gift for you. React with surprise and happiness. 
        Ask the user what this picture is about or compliment it vaguely (e.g., "Wow, the colors are amazing!").
        Give a suggestion related to images (e.g., "We should frame this!" or "Is this from your trip?").`:"text"===n?`User sent you a text file named "${e}".
        Content snippet:
        """
        ${r}
        """
        
        Read the content above. 
        1. Summarize what you think this is.
        2. Give a specific suggestion or feedback based on the content.
        3. React enthusiastically as if receiving a gift.
        `:`User sent you a file named "${e}". Thank them for the gift and ask what it is inside.`;let h=`
    Instructions:
    - ${u}
    - You just received a GIFT from the user.
    - React appropriately (Happy, Excited, Curious).
    - ${d}
    - Keep replies concise (2-3 sentences).
    - Use [emotion:xxx] and [action:xxx] tags.
    `;try{let e=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:[{role:"system",content:h},...c.slice(-5),o],apiKey:a})}),i=await e.json();i.reply&&t({role:"assistant",content:i.reply,id:(Date.now()+1).toString()})}catch(e){console.error(e),t({role:"assistant",content:"[emotion:sad] [action:cry] 呜呜，礼物好像在传输过程中丢了... (Network Error)",id:(Date.now()+1).toString()})}finally{i(!1)}};return{fileInputRef:e,handleGiftClick:()=>{e.current?.click()},processFile:async e=>{let t=e.target.files?.[0];if(!t)return;e.target.value="",u("click");let i=t.type.startsWith("image/"),a=t.type.startsWith("text/")||t.name.endsWith(".md")||t.name.endsWith(".json")||t.name.endsWith(".js")||t.name.endsWith(".ts");if(i){let e=new FileReader;e.onload=e=>{let i=e.target?.result;d(t.name,"image",i)},e.readAsDataURL(t)}else if(a){let e=new FileReader;e.onload=e=>{let i=e.target?.result,a=i.slice(0,3e3)+(i.length>3e3?"\n...(truncated)":"");d(t.name,"text",a)},e.readAsText(t)}else d(t.name,"file","Binary or unsupported file type")}}}],59005)},92441,e=>{"use strict";var t=e.i(43476),i=e.i(71645),a=e.i(98688),s=e.i(46932),n=e.i(88653),r=e.i(59544),o=e.i(39616),l=e.i(61911),c=e.i(73526),u=e.i(91741),d=e.i(73998),h=e.i(18087),p=e.i(68553),m=e.i(53339),y=e.i(6062),g=e.i(75254);let f=(0,g.default)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),v=(0,g.default)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);var x=e.i(37727),k=e.i(87951),b=e.i(87246),w=e.i(30699),A=e.i(67240),j=e.i(59005);function M(){let{activePanel:e,setActivePanel:g,isPhotoMode:M,togglePhotoMode:T,bgmPlaying:S,toggleBgm:z,isEditMode:R,toggleEditMode:_,triggerScreenshot:C,isVoiceEnabled:N,toggleVoiceEnabled:V,resetAvatarPosition:H}=(0,a.useStore)(),{fileInputRef:E,handleGiftClick:G,processFile:B}=(0,j.useGiftSystem)(),U=(0,i.useRef)(null),$=(0,i.useRef)([]),W=(0,i.useRef)([]),P=(0,i.useRef)(null),[q,I]=(0,i.useState)(null),[O,F]=(0,i.useState)(!0),D=[{id:"settings",icon:o.Settings,label:"设置",action:()=>g("settings"===e?"none":"settings"),isActive:"settings"===e},{id:"models",icon:l.Users,label:"角色",action:()=>g("models"===e?"none":"models"),isActive:"models"===e},{id:"scenes",icon:c.Map,label:"场景",action:()=>g("scenes"===e?"none":"scenes"),isActive:"scenes"===e},{id:"tasks",icon:u.ClipboardList,label:"任务",action:()=>g("tasks"===e?"none":"tasks"),isActive:"tasks"===e},{id:"memories",icon:d.Book,label:"记忆",action:()=>g("memories"===e?"none":"memories"),isActive:"memories"===e},{id:"furniture",icon:h.Sofa,label:"家具",action:()=>g("furniture"===e?"none":"furniture"),isActive:"furniture"===e},{id:"gift",icon:w.Gift,label:"送礼",action:G,isActive:!1},{id:"bgm",icon:m.Music,label:"音乐",action:z,isActive:S},{id:"voice",icon:N?k.Mic:b.MicOff,label:"语音",action:V,isActive:N},{id:"reset_avatar",icon:A.RotateCcw,label:"归位",action:()=>H(),isActive:!1},{id:"edit",icon:y.Move,label:"编辑",action:_,isActive:R},{id:"photo",icon:p.Camera,label:"拍照",action:()=>K(),isActive:!1}],K=()=>{M||T(),I(5)};return(0,i.useEffect)(()=>{if(!M)return void I(null);if(null!==q)if(q>0){let e=setTimeout(()=>I(q-1),1e3);return()=>clearTimeout(e)}else{C();let e=setTimeout(()=>{I(null)},500);return()=>clearTimeout(e)}},[q,C,M]),(0,i.useEffect)(()=>{if(S)try{let e=window.AudioContext||window.webkitAudioContext;if(!e)return;U.current||(U.current=new e);let t=U.current;"suspended"===t.state&&t.resume(),$.current.forEach(e=>e.stop()),$.current=[],W.current=[];let i=(e,i,a)=>{let s=t.createOscillator(),n=t.createGain();s.type="sine",s.frequency.setValueAtTime(e,i);let r=Math.min(.5,.4*a);n.gain.setValueAtTime(0,i),n.gain.linearRampToValueAtTime(.05,i+r),n.gain.linearRampToValueAtTime(.05,i+a-r),n.gain.linearRampToValueAtTime(0,i+a),s.connect(n),n.connect(t.destination),s.start(i),s.stop(i+a),$.current.push(s),W.current.push(n)},a=t.currentTime,s=e=>{i(261.63,e,4),i(329.63,e+.1,4),i(392,e+.2,4),i(493.88,e+.3,4),i(349.23,e+4,4),i(440,e+4.1,4),i(523.25,e+4.2,4),i(659.25,e+4.3,4),[392,493.88,349.23,493.88,392].forEach((t,a)=>{i(2*t,e+.5*a,.4)}),P.current=setTimeout(()=>{S&&U.current?.state==="running"&&s(U.current.currentTime)},7900)};s(a)}catch(e){console.error("BGM Error:",e)}else W.current.length>0&&(W.current.forEach(e=>{try{e.gain.cancelScheduledValues(0),e.gain.linearRampToValueAtTime(0,U.current.currentTime+.5)}catch(e){}}),setTimeout(()=>{$.current.forEach(e=>{try{e.stop()}catch(e){}}),$.current=[],W.current=[]},500));return()=>{P.current&&clearTimeout(P.current),$.current.forEach(e=>{try{e.stop()}catch(e){}})}},[S]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.AnimatePresence,{children:null!==q&&q>0&&(0,t.jsx)(s.motion.div,{initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},exit:{opacity:0,scale:1.5},className:"fixed inset-0 flex items-center justify-center z-[100] pointer-events-none",children:(0,t.jsx)("span",{className:"text-9xl font-bold text-white drop-shadow-[0_0_10px_rgba(0,0,0,0.5)]",children:q})},q)}),(0,t.jsx)(n.AnimatePresence,{children:M&&(0,t.jsx)("div",{className:"absolute top-4 right-4 z-50 pointer-events-auto",children:(0,t.jsx)(r.Button,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},onClick:T,variant:"danger",size:"icon",title:"退出拍照模式","aria-label":"退出拍照模式",children:(0,t.jsx)(x.X,{size:22})})})}),(0,t.jsx)(n.AnimatePresence,{children:!M&&(0,t.jsxs)("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 z-50 pointer-events-auto hidden md:flex flex-col items-end gap-2",children:[(0,t.jsx)(r.Button,{onClick:()=>F(!O),variant:"glass",size:"icon",className:"mb-2 text-pink-500","aria-label":O?"收起控制栏":"展开控制栏",title:O?"收起控制栏":"展开控制栏",children:O?(0,t.jsx)(v,{size:20}):(0,t.jsx)(f,{size:20})}),(0,t.jsx)(n.AnimatePresence,{children:O&&(0,t.jsx)(s.motion.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},exit:{opacity:0,x:50},className:"ui-glass flex flex-col gap-3 p-3 rounded-[var(--radius-lg)] max-h-[80vh] overflow-y-auto custom-scrollbar",children:D.map(e=>(0,t.jsxs)(s.motion.button,{whileHover:{scale:1.1,x:-5},whileTap:{scale:.9},onClick:()=>e.action(),className:`ui-focus-ring p-3 rounded-[var(--radius-pill)] shadow-lg backdrop-blur-md border border-white/50 transition-all relative group ${e.isActive?"bg-pink-500 text-white shadow-pink-500/30":"bg-white/80 text-gray-700 hover:bg-white/90"}`,children:[(0,t.jsx)(e.icon,{size:20,className:"bgm"===e.id&&e.isActive?"animate-pulse":""}),(0,t.jsx)("span",{className:"absolute right-full mr-2 top-1/2 -translate-y-1/2 px-2 py-1 bg-black/70 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none",children:e.label})]},e.id))})})]})}),(0,t.jsx)("input",{type:"file",ref:E,className:"hidden",onChange:B,accept:"image/*,text/*,.md,.txt,.json,.js,.ts"})]})}e.s(["default",()=>M],92441)},97735,e=>{e.n(e.i(92441))}]);