(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,59544,e=>{"use strict";var t=e.i(43476),a=e.i(932),s=e.i(46932),r=e.i(67062);let i={sm:"h-8 px-3 text-sm rounded-[var(--radius-sm)]",md:"h-10 px-4 text-sm rounded-[var(--radius-md)]",lg:"h-12 px-5 text-base rounded-[var(--radius-lg)]",icon:"h-11 w-11 rounded-[var(--radius-pill)]"},n={glass:"ui-glass text-[hsl(var(--surface-foreground))] hover:bg-[hsl(var(--surface)/0.92)]",primary:"bg-[hsl(var(--accent))] text-[hsl(var(--accent-foreground))] shadow-[0_10px_25px_rgba(236,72,153,0.28)] hover:shadow-[0_14px_30px_rgba(236,72,153,0.35)]",ghost:"bg-transparent text-[hsl(var(--surface-foreground))] hover:bg-[hsl(var(--surface)/0.12)]",danger:"bg-red-500/80 text-white hover:bg-red-600/90 shadow-[0_10px_25px_rgba(239,68,68,0.28)]"};function l(e){let l,o,c,d,h,m,u,p,x,g,f=(0,a.c)(19);f[0]!==e?({className:o,variant:m,size:u,leftIcon:c,rightIcon:h,children:l,...d}=e,f[0]=e,f[1]=l,f[2]=o,f[3]=c,f[4]=d,f[5]=h,f[6]=m,f[7]=u):(l=f[1],o=f[2],c=f[3],d=f[4],h=f[5],m=f[6],u=f[7]);let v=void 0===m?"glass":m,y=void 0===u?"md":u;f[8]===Symbol.for("react.memo_cache_sentinel")?(p={scale:.96},f[8]=p):p=f[8];let b=i[y],j=n[v];return f[9]!==o||f[10]!==b||f[11]!==j?(x=(0,r.cn)("ui-focus-ring inline-flex select-none items-center justify-center gap-2 font-medium transition-[transform,background-color,color,box-shadow,border-color] active:scale-[0.98] disabled:opacity-50 disabled:pointer-events-none",b,j,o),f[9]=o,f[10]=b,f[11]=j,f[12]=x):x=f[12],f[13]!==l||f[14]!==c||f[15]!==d||f[16]!==h||f[17]!==x?(g=(0,t.jsxs)(s.motion.button,{whileTap:p,className:x,...d,children:[c,l,h]}),f[13]=l,f[14]=c,f[15]=d,f[16]=h,f[17]=x,f[18]=g):g=f[18],g}e.s(["Button",()=>l])},7865,e=>{"use strict";var t=e.i(43476),a=e.i(932),s=e.i(46932),r=e.i(67062);function i(e){let i,n,l,o,c,d,h,m,u,p,x,g,f=(0,a.c)(24);return f[0]!==e?({title:h,subtitle:d,right:c,children:i,className:n,contentClassName:l,...o}=e,f[0]=e,f[1]=i,f[2]=n,f[3]=l,f[4]=o,f[5]=c,f[6]=d,f[7]=h):(i=f[1],n=f[2],l=f[3],o=f[4],c=f[5],d=f[6],h=f[7]),f[8]!==n?(m=(0,r.cn)("ui-glass rounded-[var(--radius-lg)]",n),f[8]=n,f[9]=m):m=f[9],f[10]!==c||f[11]!==d||f[12]!==h?(u=(h||d||c)&&(0,t.jsxs)("div",{className:"flex items-start gap-3 px-4 pt-4",children:[(0,t.jsxs)("div",{className:"min-w-0",children:[h&&(0,t.jsx)("div",{className:"font-semibold text-gray-900 dark:text-gray-100",children:h}),d&&(0,t.jsx)("div",{className:"text-xs text-gray-600 dark:text-gray-300/80",children:d})]}),c&&(0,t.jsx)("div",{className:"ml-auto flex-shrink-0",children:c})]}),f[10]=c,f[11]=d,f[12]=h,f[13]=u):u=f[13],f[14]!==l?(p=(0,r.cn)("px-4 pb-4 pt-3",l),f[14]=l,f[15]=p):p=f[15],f[16]!==i||f[17]!==p?(x=(0,t.jsx)("div",{className:p,children:i}),f[16]=i,f[17]=p,f[18]=x):x=f[18],f[19]!==o||f[20]!==m||f[21]!==u||f[22]!==x?(g=(0,t.jsxs)(s.motion.div,{className:m,...o,children:[u,x]}),f[19]=o,f[20]=m,f[21]=u,f[22]=x,f[23]=g):g=f[23],g}e.s(["Panel",()=>i])},61911,e=>{"use strict";let t=(0,e.i(75254).default)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]);e.s(["Users",()=>t],61911)},43531,e=>{"use strict";let t=(0,e.i(75254).default)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);e.s(["Check",()=>t],43531)},81230,e=>{"use strict";var t=e.i(43476),a=e.i(98688),s=e.i(46932),r=e.i(88653),i=e.i(71645),n=e.i(61911),l=e.i(43531);let o=(0,e.i(75254).default)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]);var c=e.i(7865),d=e.i(59544);function h(){let{availableModels:e,activeModels:h,addActiveModel:m,removeActiveModel:u,setAvailableModels:p,apiKey:x,addMessage:g,activePanel:f,setActivePanel:v}=(0,a.useStore)(),y=(0,i.useRef)(null),b=async e=>{if(!x)return`You are ${e}, a friendly anime character.`;try{let t=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:[{role:"system",content:"You are an expert character designer. Generate a short, engaging system prompt (persona) for an anime character based on their name. The prompt should define their personality, speaking style, and catchphrases. Keep it under 50 words. Output ONLY the prompt text."},{role:"user",content:`Generate a persona for a character named "${e}".`}],apiKey:x})});return(await t.json()).reply||`You are ${e}.`}catch(t){return console.error("Failed to generate persona:",t),`You are ${e}.`}};(0,i.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/models");if(e.ok){let t=await e.json();p(t)}}catch(e){console.error("Failed to fetch models:",e)}})()},[p]);let j=async e=>{let t=e.target.files?.[0];if(!t)return;if(!t.name.toLowerCase().endsWith(".vrm"))return void alert("请选择 .vrm 格式的模型文件");let a=URL.createObjectURL(t),s=t.name.replace(/\.vrm$/i,""),r=await b(s);g({role:"assistant",content:`已导入模型 [${s}]。AI生成的设定：${r}`,id:Date.now().toString()});let i={id:`custom-${Date.now()}`,name:s,url:a,description:r,defaultEmotion:"neutral"};p(e=>[i,...e]),e.target.value=""};return(0,t.jsx)("div",{className:"absolute top-4 right-20 z-50",children:(0,t.jsx)(r.AnimatePresence,{children:"models"===f&&(0,t.jsx)(c.Panel,{initial:{opacity:0,scale:.92,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.92,y:20},className:"fixed inset-x-4 top-20 md:absolute md:top-16 md:right-0 md:w-72 md:inset-auto z-50",title:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(n.Users,{size:18,className:"text-pink-500"}),(0,t.jsx)("span",{children:"选择角色"})]}),right:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{type:"file",ref:y,onChange:j,accept:".vrm",className:"hidden"}),(0,t.jsx)(d.Button,{onClick:()=>{y.current?.click()},variant:"glass",size:"sm",className:"text-blue-700 bg-white/70 hover:bg-white/90",title:"导入本地 VRM 模型","aria-label":"导入本地 VRM 模型",leftIcon:(0,t.jsx)(o,{size:14}),children:"导入"}),(0,t.jsxs)("span",{className:"text-xs text-gray-600",children:["已选 ",h.length,"/3"]})]}),children:(0,t.jsx)("div",{className:"grid grid-cols-2 gap-2 max-h-60 overflow-y-auto",children:e.map(e=>{let a=h.some(t=>t.id===e.id);return(0,t.jsxs)(s.motion.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>{h.some(t=>t.id===e.id)?h.length>1&&u(e.id):h.length<3&&m(e)},disabled:!a&&h.length>=3,className:`ui-focus-ring p-2 rounded-lg text-sm text-left transition-colors flex flex-col gap-1 relative ${a?"bg-pink-500 text-white shadow-md":h.length>=3?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-pink-50 text-pink-700 hover:bg-pink-100"}`,children:[(0,t.jsxs)("div",{className:"flex justify-between items-start w-full",children:[(0,t.jsx)("span",{className:"font-medium truncate pr-4",children:e.name}),a&&(0,t.jsx)(l.Check,{size:14})]}),(0,t.jsx)("div",{className:"text-xs opacity-80 line-clamp-2 w-full mt-1 bg-black/5 p-1 rounded",children:e.description})]},e.id)})})})})})}e.s(["default",()=>h],81230)},67960,e=>{e.n(e.i(81230))}]);