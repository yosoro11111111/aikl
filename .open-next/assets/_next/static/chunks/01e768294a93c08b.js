(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,61911,e=>{"use strict";let t=(0,e.i(75254).default)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]);e.s(["Users",()=>t],61911)},18087,53339,6062,e=>{"use strict";var t=e.i(75254);let a=(0,t.default)("sofa",[["path",{d:"M20 9V6a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v3",key:"1dgpiv"}],["path",{d:"M2 16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-5a2 2 0 0 0-4 0v1.5a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5V11a2 2 0 0 0-4 0z",key:"xacw8m"}],["path",{d:"M4 18v2",key:"jwo5n2"}],["path",{d:"M20 18v2",key:"1ar1qi"}],["path",{d:"M12 4v9",key:"oqhhn3"}]]);e.s(["Sofa",()=>a],18087);let i=(0,t.default)("music",[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]]);e.s(["Music",()=>i],53339);let o=(0,t.default)("move",[["path",{d:"M12 2v20",key:"t6zp3m"}],["path",{d:"m15 19-3 3-3-3",key:"11eu04"}],["path",{d:"m19 9 3 3-3 3",key:"1mg7y2"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"m5 9-3 3 3 3",key:"j64kie"}],["path",{d:"m9 5 3-3 3 3",key:"l8vdw6"}]]);e.s(["Move",()=>o],6062)},93548,e=>{"use strict";var t=e.i(43476),a=e.i(932),i=e.i(71645),o=e.i(98688),l=e.i(46932),r=e.i(88653);let n={bed:[{label:"睡觉 (Sleep)",action:"sleep",targetOffset:[0,.46,0],lookAtOffset:[0,.46,2]},{label:"坐下 (Sit)",action:"sit_bed",targetOffset:[.5,0,0],lookAtOffset:[0,.5,1]},{label:"起床 (Wake Up)",action:"idle",targetOffset:[1.2,0,0],lookAtOffset:[0,.5,1]}],sofa:[{label:"坐下 (Sit)",action:"sit_sofa",targetOffset:[0,0,.3],lookAtOffset:[0,.5,1]},{label:"躺下 (Lie)",action:"lie_sofa",targetOffset:[0,.5,0],lookAtOffset:[1,.5,0]},{label:"站起 (Stand Up)",action:"idle",targetOffset:[0,0,1],lookAtOffset:[0,.5,1]}],chair:[{label:"坐下 (Sit)",action:"sit_chair",targetOffset:[0,0,.1],lookAtOffset:[0,.5,1]},{label:"站起 (Stand Up)",action:"idle",targetOffset:[0,0,1],lookAtOffset:[0,.5,1]}],table:[{label:"观察 (Observe)",action:"idle_look_around",targetOffset:[0,0,1],lookAtOffset:[0,.5,0]},{label:"擦桌子 (Clean)",action:"reach_out",targetOffset:[0,0,.8],lookAtOffset:[0,.5,0]}],piano:[{label:"弹奏 (Play)",action:"play_piano",targetOffset:[0,0,.5],lookAtOffset:[0,.5,-1]},{label:"停止 (Stop)",action:"idle",targetOffset:[0,0,1],lookAtOffset:[0,.5,1]}],computer:[{label:"使用 (Use)",action:"type_keyboard",targetOffset:[0,0,.5],lookAtOffset:[0,.5,-1]},{label:"离开 (Leave)",action:"idle",targetOffset:[0,0,1],lookAtOffset:[0,.5,1]}],cat_bed:[{label:"查看 (Check)",action:"crouch",targetOffset:[0,0,.8],lookAtOffset:[0,0,0]}],lamp:[{label:"开关 (Toggle)",action:"reach_out",targetOffset:[.5,0,0],lookAtOffset:[0,1,0]}],coffee_machine:[{label:"泡咖啡 (Brew)",action:"brew_coffee",targetOffset:[0,0,.6],lookAtOffset:[0,.5,0]},{label:"喝咖啡 (Drink)",action:"idle",targetOffset:[0,0,.6],lookAtOffset:[0,.5,0]}],tree:[{label:"欣赏 (Admire)",action:"idle_look_around",targetOffset:[0,0,1.5],lookAtOffset:[0,1,0]},{label:"浇水 (Water)",action:"reach_out",targetOffset:[.5,0,1],lookAtOffset:[0,.5,0]}],bookshelf:[{label:"浏览 (Browse)",action:"idle_look_around",targetOffset:[0,0,1],lookAtOffset:[0,1,0]},{label:"拿书 (Take Book)",action:"reach_out",targetOffset:[.3,0,.8],lookAtOffset:[0,1.5,0]}],rug:[{label:"站立 (Stand)",action:"idle_look_around",targetOffset:[0,0,0],lookAtOffset:[0,0,1]},{label:"躺下 (Lie)",action:"sleep",targetOffset:[0,0,0],lookAtOffset:[0,0,2]}],tv:[{label:"看电视 (Watch)",action:"idle_look_around",targetOffset:[0,0,2],lookAtOffset:[0,.5,0]},{label:"关闭 (Turn Off)",action:"reach_out",targetOffset:[.5,0,.5],lookAtOffset:[0,.5,0]}],plant:[{label:"浇水 (Water)",action:"reach_out",targetOffset:[.4,0,.4],lookAtOffset:[0,.5,0]},{label:"修剪 (Trim)",action:"reach_out",targetOffset:[.3,0,.3],lookAtOffset:[0,.5,0]}],clock:[{label:"看时间 (Check Time)",action:"idle_look_around",targetOffset:[0,0,1],lookAtOffset:[0,1,0]}],painting:[{label:"鉴赏 (Appreciate)",action:"idle_look_around",targetOffset:[0,0,1],lookAtOffset:[0,.5,0]}],desk:[{label:"工作 (Work)",action:"type_keyboard",targetOffset:[0,0,.6],lookAtOffset:[0,.5,-.5]},{label:"整理 (Organize)",action:"reach_out",targetOffset:[0,0,.6],lookAtOffset:[0,.5,0]}],stool:[{label:"坐下 (Sit)",action:"sit_chair",targetOffset:[0,0,0],lookAtOffset:[0,.5,1]},{label:"站起 (Stand Up)",action:"idle",targetOffset:[0,0,1],lookAtOffset:[0,.5,1]}],cabinet:[{label:"打开 (Open)",action:"reach_out",targetOffset:[0,0,.8],lookAtOffset:[0,.5,0]}],mirror:[{label:"照镜子 (Look)",action:"idle_look_around",targetOffset:[0,0,.8],lookAtOffset:[0,1,0]}],fireplace:[{label:"取暖 (Warm)",action:"crouch",targetOffset:[0,0,1],lookAtOffset:[0,.5,0]}],bean_bag:[{label:"休息 (Rest)",action:"sit_sofa",targetOffset:[0,.2,0],lookAtOffset:[0,.5,1]},{label:"站起 (Stand Up)",action:"idle",targetOffset:[0,0,1],lookAtOffset:[0,.5,1]}]};var s=e.i(18087),c=e.i(75254);let d=(0,c.default)("bed",[["path",{d:"M2 4v16",key:"vw9hq8"}],["path",{d:"M2 8h18a2 2 0 0 1 2 2v10",key:"1dgv2r"}],["path",{d:"M2 17h20",key:"18nfp3"}],["path",{d:"M6 8v9",key:"1yriud"}]]),f=(0,c.default)("table",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]),h=(0,c.default)("armchair",[["path",{d:"M19 9V6a2 2 0 0 0-2-2H7a2 2 0 0 0-2 2v3",key:"irtipd"}],["path",{d:"M3 16a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-5a2 2 0 0 0-4 0v1.5a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5V11a2 2 0 0 0-4 0z",key:"1qyhux"}],["path",{d:"M5 18v2",key:"ppbyun"}],["path",{d:"M19 18v2",key:"gy7782"}]]),p=(0,c.default)("lamp",[["path",{d:"M12 12v6",key:"3ahymv"}],["path",{d:"M4.077 10.615A1 1 0 0 0 5 12h14a1 1 0 0 0 .923-1.385l-3.077-7.384A2 2 0 0 0 15 2H9a2 2 0 0 0-1.846 1.23Z",key:"1l7kg2"}],["path",{d:"M8 20a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v1a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1z",key:"1mmzpi"}]]),u=(0,c.default)("tree-pine",[["path",{d:"m17 14 3 3.3a1 1 0 0 1-.7 1.7H4.7a1 1 0 0 1-.7-1.7L7 14h-.3a1 1 0 0 1-.7-1.7L9 9h-.2A1 1 0 0 1 8 7.3L12 3l4 4.3a1 1 0 0 1-.8 1.7H15l3 3.3a1 1 0 0 1-.7 1.7H17Z",key:"cpyugq"}],["path",{d:"M12 22v-3",key:"kmzjlo"}]]),m=(0,c.default)("library",[["path",{d:"m16 6 4 14",key:"ji33uf"}],["path",{d:"M12 6v14",key:"1n7gus"}],["path",{d:"M8 8v12",key:"1gg7y9"}],["path",{d:"M4 4v16",key:"6qkkli"}]]),y=(0,c.default)("layers",[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]]),x=(0,c.default)("monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]),g=(0,c.default)("flower",[["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["path",{d:"M12 16.5A4.5 4.5 0 1 1 7.5 12 4.5 4.5 0 1 1 12 7.5a4.5 4.5 0 1 1 4.5 4.5 4.5 4.5 0 1 1-4.5 4.5",key:"14wa3c"}],["path",{d:"M12 7.5V9",key:"1oy5b0"}],["path",{d:"M7.5 12H9",key:"eltsq1"}],["path",{d:"M16.5 12H15",key:"vk5kw4"}],["path",{d:"M12 16.5V15",key:"k7eayi"}],["path",{d:"m8 8 1.88 1.88",key:"nxy4qf"}],["path",{d:"M14.12 9.88 16 8",key:"1lst6k"}],["path",{d:"m8 16 1.88-1.88",key:"h2eex1"}],["path",{d:"M14.12 14.12 16 16",key:"uqkrx3"}]]);var b=e.i(3116);let k=(0,c.default)("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),v=(0,c.default)("disc",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),w=(0,c.default)("archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]),O=(0,c.default)("box",[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]),j=(0,c.default)("flame",[["path",{d:"M12 3q1 4 4 6.5t3 5.5a1 1 0 0 1-14 0 5 5 0 0 1 1-3 1 1 0 0 0 5 0c0-2-1.5-3-1.5-5q0-2 2.5-4",key:"1slcih"}]]);var M=e.i(53339);let z=(0,c.default)("laptop",[["path",{d:"M18 5a2 2 0 0 1 2 2v8.526a2 2 0 0 0 .212.897l1.068 2.127a1 1 0 0 1-.9 1.45H3.62a1 1 0 0 1-.9-1.45l1.068-2.127A2 2 0 0 0 4 15.526V7a2 2 0 0 1 2-2z",key:"1pdavp"}],["path",{d:"M20.054 15.987H3.946",key:"14rxg9"}]]);var A=e.i(90597);let _=(0,c.default)("circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),N=(0,c.default)("house",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]]);var V=e.i(27612),S=e.i(37727);let C=(0,c.default)("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]]),H=(0,c.default)("coffee",[["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M14 2v2",key:"6buw04"}],["path",{d:"M16 8a1 1 0 0 1 1 1v8a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V9a1 1 0 0 1 1-1h14a4 4 0 1 1 0 8h-1",key:"pwadti"}],["path",{d:"M6 2v2",key:"colzsn"}]]);var P=e.i(6062);let q=(0,c.default)("rotate-3d",[["path",{d:"M16.466 7.5C15.643 4.237 13.952 2 12 2 9.239 2 7 6.477 7 12s2.239 10 5 10c.342 0 .677-.069 1-.2",key:"10n0gc"}],["path",{d:"m15.194 13.707 3.814 1.86-1.86 3.814",key:"16shm9"}],["path",{d:"M19 15.57c-1.804.885-4.274 1.43-7 1.43-5.523 0-10-2.239-10-5s4.477-5 10-5c4.838 0 8.873 1.718 9.8 4",key:"1lxi77"}]]),$=(0,c.default)("scaling",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M14 15H9v-5",key:"pi4jk9"}],["path",{d:"M16 3h5v5",key:"1806ms"}],["path",{d:"M21 3 9 15",key:"15kdhq"}]]);var E=e.i(61911);let T=(0,c.default)("mouse-pointer-2",[["path",{d:"M4.037 4.688a.495.495 0 0 1 .651-.651l16 6.5a.5.5 0 0 1-.063.947l-6.124 1.58a2 2 0 0 0-1.438 1.435l-1.579 6.126a.5.5 0 0 1-.947.063z",key:"edeuup"}]]);var U=e.i(90072),L=e.i(35471),W=e.i(67697);function B(e,t){let a=new U.Vector3(...e.position),i=t.distanceTo(a),o=a.clone().sub(t).normalize(),l=new U.Vector3(0,0,-1),r=Math.acos(o.dot(l));return{isFeasible:i<3&&r<Math.PI/2,distance:i,angle:r}}function I(e){switch(e.type){case"chair":return"点击椅子让角色坐下";case"table":return"点击桌子让角色站在桌边";case"bed":return"点击床让角色躺下";case"sofa":return"点击沙发让角色坐下";default:return"点击家具与角色互动"}}function F(e){switch(e){case"chair":case"sofa":return"sit";case"bed":return"lie_down";case"table":return"stand_interact";default:return"idle"}}function Q(e){let t=new U.Vector3(...e);return t.x>=-2.5&&t.x<=2.5&&t.z>=-2&&t.z<=3.5&&t.y>=-.5&&t.y<=2}function R(e,t){for(let a of t){let t,i=new U.Vector3(...a.position);switch(a.type){case"chair":case"sofa":t={position:i,size:new U.Vector3(.8,1,.8),type:"box"};break;case"table":t={position:i,size:new U.Vector3(1.2,.8,1.2),type:"box"};break;case"bed":t={position:i,size:new U.Vector3(2,.5,1.5),type:"box"};break;default:t={position:i,size:new U.Vector3(1,1,1),type:"box"}}let o=new U.Vector3(Math.max(t.position.x-t.size.x/2,Math.min(e.x,t.position.x+t.size.x/2)),Math.max(t.position.y-t.size.y/2,Math.min(e.y,t.position.y+t.size.y/2)),Math.max(t.position.z-t.size.z/2,Math.min(e.z,t.position.z+t.size.z/2)));if(.3>e.distanceTo(o))return!0}return!1}function Z(e,t,a){t.clone().sub(e).normalize();let i=t.clone();for(let t of a){let a=new U.Vector3(...t.position).clone().sub(e);if(2>a.length()){let e=new U.Vector3(-a.z,0,a.x).normalize();i.add(e.multiplyScalar(.5))}}return i}function D(){let e,c,D,X,G,J,Y,ee,et,ea,ei,eo,el,er,en,es=(0,a.c)(31),{scene:ec,addFurniture:ed,furniture:ef,removeFurniture:eh,activePanel:ep,setActivePanel:eu,selectedFurnitureId:em,setSelectedFurnitureId:ey,startInteraction:ex,isEditMode:eg,toggleEditMode:eb,transformMode:ek,setTransformMode:ev,triggerAI:ew,activeModels:eO}=(0,o.useStore)(),[ej,eM]=(0,i.useState)("add"),[ez,eA]=(0,i.useState)("lumina");es[0]===Symbol.for("react.memo_cache_sentinel")?(e={width:1920,height:1080},es[0]=e):e=es[0];let[e_,eN]=(0,i.useState)(e),eV=e_.width/e_.height;es[1]!==eV?(c=new U.PerspectiveCamera(75,eV,.1,1e3),es[1]=eV,es[2]=c):c=es[2],es[3]!==e_||es[4]!==c?(D={size:e_,camera:c},es[3]=e_,es[4]=c,es[5]=D):D=es[5],es[6]===Symbol.for("react.memo_cache_sentinel")?(X={margin:.4,enableSmartPositioning:!0,enableBoundaryConstraints:!0,enablePostureAdaptation:!0},es[6]=X):X=es[6];let{computeSmartInteractionTarget:eS,isInteractionWithinBounds:eC,checkCollision:eH,calculateAvoidancePath:eP,initializePhysics:eq}=((e,t)=>{let i,o,l,r,n,s=(0,a.c)(13);s[0]!==t?(i=void 0===t?{}:t,s[0]=t,s[1]=i):i=s[1];let c=i,d=c.margin||.4;s[2]!==d?(o={margin:d,enableX:!0,enableZ:!0,bounceEffect:!1},s[2]=d,s[3]=o):o=s[3];let{constrainPosition:f}=(0,L.useViewportBoundary)(e,o),h=(0,W.useAdvancedPhysics)(),{enableBoundaryConstraints:p,enablePostureAdaptation:u}=c,m=void 0===p||p,y=void 0===u||u;s[4]!==f||s[5]!==m||s[6]!==y?(l=e=>{let t,a=new U.Vector3(...e.position),i=new U.Euler(...e.rotation),o=new U.Quaternion().setFromEuler(i),l=a.clone(),r=new U.Euler().copy(i);switch(e.type){case"chair":{let e=new U.Vector3(0,0,-1).applyQuaternion(o);l.add(e.multiplyScalar(.3)),l.y=l.y+.5,r.y=Math.atan2(e.x,e.z),y&&(t={rotation:[0,0,0],scale:.9});break}case"table":{let e=new U.Vector3(0,0,-1).applyQuaternion(o);l.add(e.multiplyScalar(.5)),r.y=Math.atan2(e.x,e.z),y&&(t={rotation:[0,0,0],scale:1});break}case"bed":l.y=l.y+.2,y&&(t={rotation:[0,0,0],scale:.8});break;case"sofa":{let e=new U.Vector3(0,0,-1).applyQuaternion(o);l.add(e.multiplyScalar(.4)),l.y=l.y+.3,r.y=Math.atan2(e.x,e.z),y&&(t={rotation:[0,0,0],scale:.85});break}default:{let e=new U.Vector3(0,0,-1).applyQuaternion(o);l.add(e.multiplyScalar(.6)),r.y=Math.atan2(e.x,e.z)}}return m&&(l=f(l)),{targetPos:[l.x,l.y,l.z],targetRot:[r.x,r.y,r.z],postureAdjustment:t}},s[4]=f,s[5]=m,s[6]=y,s[7]=l):l=s[7];let x=l;s[8]!==h?(r=e=>{h.addGroundConstraint(-.5),e.forEach((e,t)=>{let a=new U.Vector3(...e.position);h.addPhysicsObject(`furniture_${t}`,{position:a,velocity:new U.Vector3(0,0,0),acceleration:new U.Vector3(0,0,0),mass:1/0,isStatic:!0,colliderType:"box",size:new U.Vector3(1,1,1)})}),h.startPhysics()},s[8]=h,s[9]=r):r=s[9];let g=r;return s[10]!==x||s[11]!==g?(n={computeSmartInteractionTarget:x,checkInteractionFeasibility:B,getInteractionHint:I,getInteractionAnimation:F,isInteractionWithinBounds:Q,checkCollision:R,calculateAvoidancePath:Z,initializePhysics:g},s[10]=x,s[11]=g,s[12]=n):n=s[12],n})(D,X);es[7]===Symbol.for("react.memo_cache_sentinel")?(G=()=>{{eN({width:window.innerWidth,height:window.innerHeight});let e=()=>eN({width:window.innerWidth,height:window.innerHeight});return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}},J=[],es[7]=G,es[8]=J):(G=es[7],J=es[8]),(0,i.useEffect)(G,J),es[9]!==ef||es[10]!==eq?(Y=()=>{ef.length>0&&eq(ef)},ee=[ef,eq],es[9]=ef,es[10]=eq,es[11]=Y,es[12]=ee):(Y=es[11],ee=es[12]),(0,i.useEffect)(Y,ee),es[13]!==eO||es[14]!==ez?(ea=()=>{eO.length>0&&(eO.find(e=>e.id===ez)||eA(eO[0].id))},et=[eO,ez],es[13]=eO,es[14]=ez,es[15]=et,es[16]=ea):(et=es[15],ea=es[16]),(0,i.useEffect)(ea,et),es[17]!==eP||es[18]!==eH||es[19]!==eS||es[20]!==ef||es[21]!==eC?(ei=(e,t)=>{let a=eS(e);eC(a.targetPos)||console.warn("家具交互位置超出边界，已自动调整");let i=new U.Vector3(...a.targetPos),o=new U.Vector3(0,0,0);if(eH(i,ef)){console.log("检测到碰撞，计算避障路径");let e=eP(o,i,ef);a.targetPos=[e.x,e.y,e.z]}return a},es[17]=eP,es[18]=eH,es[19]=eS,es[20]=ef,es[21]=eC,es[22]=ei):ei=es[22];let e$=ei,eE=[{id:"bed",name:"床",icon:d},{id:"sofa",name:"沙发",icon:s.Sofa},{id:"table",name:"桌子",icon:f},{id:"chair",name:"椅子",icon:h},{id:"lamp",name:"台灯",icon:p},{id:"tree",name:"树",icon:u},{id:"bookshelf",name:"书架",icon:m},{id:"rug",name:"地毯",icon:y},{id:"tv",name:"电视",icon:x},{id:"plant",name:"植物",icon:g},{id:"clock",name:"时钟",icon:b.Clock},{id:"painting",name:"画作",icon:k},{id:"desk",name:"书桌",icon:f},{id:"stool",name:"凳子",icon:v},{id:"cabinet",name:"柜子",icon:w},{id:"mirror",name:"镜子",icon:O},{id:"fireplace",name:"壁炉",icon:j},{id:"piano",name:"钢琴",icon:M.Music},{id:"computer",name:"电脑",icon:z},{id:"cat_bed",name:"猫窝",icon:A.Heart},{id:"bean_bag",name:"懒人沙发",icon:_},{id:"coffee_machine",name:"咖啡机",icon:H}];es[23]!==ec?(eo=e=>e.scene===ec,es[23]=ec,es[24]=eo):eo=es[24];let eT=ef.filter(eo);es[25]!==em?(el=()=>{em&&eM("current")},er=[em],es[25]=em,es[26]=el,es[27]=er):(el=es[26],er=es[27]),(0,i.useEffect)(el,er);let eU=r.AnimatePresence,eL="furniture"===ep&&(0,t.jsxs)(l.motion.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},className:"pointer-events-auto fixed bottom-0 left-0 right-0 top-auto md:top-0 md:bottom-auto md:left-16 md:right-auto md:w-[360px] bg-white/95 backdrop-blur-xl rounded-t-2xl md:rounded-xl shadow-[0_-10px_40px_rgba(0,0,0,0.1)] md:shadow-2xl border-t md:border border-white/50 z-[9999] flex flex-col max-h-[80vh] md:max-h-[600px] safe-area-bottom",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center p-4 border-b border-gray-100 shrink-0",children:[(0,t.jsxs)("h3",{className:"font-bold text-gray-800 flex items-center gap-2",children:[(0,t.jsx)(N,{size:18,className:"text-pink-500"}),"家具库"]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("button",{onClick:eb,className:`p-1.5 rounded-full transition-colors ${eg?"bg-blue-100 text-blue-600":"text-gray-400 hover:bg-gray-100"}`,title:eg?"退出编辑模式":"进入编辑模式",children:(0,t.jsx)(P.Move,{size:18})}),(0,t.jsx)("button",{onClick:()=>eu("none"),className:"text-gray-400 hover:text-gray-600 transition-colors p-1 hover:bg-gray-100 rounded-full",children:(0,t.jsx)(S.X,{size:20})})]})]}),(0,t.jsxs)("div",{className:"flex p-1 mx-4 mt-2 bg-gray-100/50 rounded-lg shrink-0",children:[(0,t.jsx)("button",{onClick:()=>eM("add"),className:`flex-1 py-1.5 text-xs font-medium rounded-md transition-all ${"add"===ej?"bg-white text-gray-800 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:"添加家具"}),(0,t.jsxs)("button",{onClick:()=>eM("current"),className:`flex-1 py-1.5 text-xs font-medium rounded-md transition-all flex items-center justify-center gap-1.5 ${"current"===ej?"bg-white text-gray-800 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:["已放置",eT.length>0&&(0,t.jsx)("span",{className:"bg-pink-100 text-pink-600 px-1.5 py-0.5 rounded-full text-[10px]",children:eT.length})]})]}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-4 min-h-0",children:"add"===ej?(0,t.jsx)("div",{className:"grid grid-cols-4 gap-3 content-start pb-4",children:eE.map(e=>(0,t.jsxs)(l.motion.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>{ed({id:`${e.id}-${Date.now()}`,type:e.id,name:e.name,position:[2*Math.random()-1,0,2*Math.random()-1],rotation:[0,Math.random()*Math.PI*2,0],scale:[1,1,1],scene:ec})},className:"p-2 bg-white rounded-xl shadow-sm border border-gray-100 flex flex-col items-center gap-2 hover:border-pink-300 hover:shadow-md transition-all aspect-square justify-center group",children:[(0,t.jsx)(e.icon,{size:24,className:"text-pink-400 group-hover:text-pink-500 transition-colors"}),(0,t.jsx)("span",{className:"text-[10px] text-gray-500 group-hover:text-gray-700 truncate w-full text-center font-medium",children:e.name})]},e.id))}):(0,t.jsx)("div",{className:"flex flex-col gap-4 pb-4",children:0===eT.length?(0,t.jsxs)("div",{className:"text-center py-8 text-gray-400 text-sm flex flex-col items-center gap-2",children:[(0,t.jsx)(O,{size:32,className:"opacity-20"}),(0,t.jsx)("span",{children:"当前场景还没有家具哦"}),(0,t.jsx)("button",{onClick:()=>eM("add"),className:"text-pink-500 font-medium hover:underline mt-2",children:"去添加"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.AnimatePresence,{mode:"wait",children:em&&(()=>{let e=ef.find(e=>e.id===em);if(!e)return null;let a=n[e.type]||[];return(0,t.jsxs)(l.motion.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"flex flex-col gap-3 overflow-hidden",children:[eg&&(0,t.jsxs)("div",{className:"bg-white p-3 rounded-xl border border-gray-200 shadow-sm",children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,t.jsxs)("span",{className:"text-xs text-gray-500 font-medium flex items-center gap-1.5",children:[(0,t.jsx)(T,{size:12}),"调整模式"]})}),(0,t.jsx)("div",{className:"grid grid-cols-3 gap-1 bg-gray-100/50 p-1 rounded-lg",children:[{id:"translate",label:"移动",icon:P.Move},{id:"rotate",label:"旋转",icon:q},{id:"scale",label:"缩放",icon:$}].map(e=>(0,t.jsxs)("button",{onClick:()=>ev(e.id),className:`
                                                        relative flex flex-col items-center justify-center gap-1 py-2 rounded-md text-xs font-medium transition-all duration-200
                                                        ${ek===e.id?"bg-white text-blue-600 shadow-sm ring-1 ring-black/5":"text-gray-500 hover:text-gray-700 hover:bg-gray-200/50"}
                                                    `,children:[(0,t.jsx)(e.icon,{size:16,strokeWidth:ek===e.id?2.5:2}),(0,t.jsx)("span",{children:e.label}),ek===e.id&&(0,t.jsx)(l.motion.div,{layoutId:"activeTab",className:"absolute inset-0 border-2 border-blue-500/10 rounded-md",transition:{type:"spring",stiffness:500,damping:30}})]},e.id))})]}),(0,t.jsxs)("div",{className:"bg-purple-50/50 p-3 rounded-xl border border-purple-100",children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,t.jsxs)("span",{className:"text-xs text-purple-600 font-medium flex items-center gap-1.5",children:[(0,t.jsx)(E.Users,{size:12}),"互动角色"]})}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("select",{value:ez,onChange:e=>eA(e.target.value),className:"w-full text-xs bg-white border border-purple-200 rounded-lg pl-3 pr-8 py-2 text-gray-700 outline-none focus:border-purple-400 focus:ring-2 focus:ring-purple-100 transition-all appearance-none cursor-pointer hover:bg-purple-50/30",children:eO.map(K)}),(0,t.jsx)("div",{className:"absolute right-2.5 top-1/2 -translate-y-1/2 pointer-events-none text-purple-400",children:(0,t.jsx)(E.Users,{size:14})})]})]}),(0,t.jsxs)("div",{className:"bg-blue-50/50 p-3 rounded-xl border border-blue-100",children:[(0,t.jsxs)("span",{className:"text-xs text-blue-600 font-medium mb-2 flex items-center gap-1.5",children:[(0,t.jsx)(C,{size:12}),a.length>0?`与 ${e.name} 互动`:`关于 ${e.name}`]}),(0,t.jsx)("div",{className:"grid grid-cols-2 gap-2",children:a.length>0?a.map((a,i)=>(0,t.jsxs)("button",{onClick:()=>{try{let{targetPos:t,targetRot:i}=e$(e,a);ex(t,i,a.action,ez),ew(`[System Event] ${ez} triggered interaction: ${a.label} with ${e.name}`)}catch(e){console.error("Interaction Error:",e),ew(`[Error] Failed to start interaction: ${e}`)}},className:"flex items-center justify-center gap-1.5 bg-white px-3 py-2.5 rounded-lg shadow-sm border border-blue-100 text-xs font-medium text-blue-700 hover:bg-blue-50 hover:border-blue-300 transition-all active:scale-95 group",children:[(0,t.jsx)(C,{size:12,className:"fill-blue-700/20 group-hover:fill-blue-700 transition-colors"}),a.label]},i)):(0,t.jsxs)("button",{onClick:()=>ew(`[System Event] User asks about ${e.name}.`),className:"col-span-2 flex items-center justify-center gap-1.5 bg-white px-3 py-2.5 rounded-lg shadow-sm border border-gray-200 text-xs font-medium text-gray-600 hover:bg-gray-50 transition-all active:scale-95",children:[(0,t.jsx)(C,{size:12}),"询问 AI 关于此家具"]})})]})]})})()}),(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsx)("span",{className:"text-xs text-gray-500 font-medium px-1",children:"家具列表"}),eT.map(e=>(0,t.jsxs)("div",{onClick:()=>ey(e.id===em?null:e.id),className:`flex justify-between items-center text-sm p-3 rounded-xl cursor-pointer transition-all ${e.id===em?"bg-white border-pink-400 shadow-sm ring-1 ring-pink-100":"bg-gray-50/50 hover:bg-white border-transparent hover:shadow-sm border"}`,children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 overflow-hidden",children:[(0,t.jsx)("div",{className:`w-2 h-2 rounded-full shrink-0 ${e.id===em?"bg-pink-500":"bg-gray-300"}`}),(0,t.jsx)("span",{className:`truncate font-medium ${e.id===em?"text-pink-600":"text-gray-700"}`,children:e.name})]}),(0,t.jsx)("button",{onClick:t=>{t.stopPropagation(),eh(e.id)},className:"text-gray-400 hover:text-red-500 p-2 hover:bg-red-50 rounded-lg transition-colors",title:"删除",children:(0,t.jsx)(V.Trash2,{size:16})})]},e.id))]})]})})})]});return es[28]!==eU||es[29]!==eL?(en=(0,t.jsx)("div",{className:"z-50 pointer-events-none",children:(0,t.jsx)(eU,{children:eL})}),es[28]=eU,es[29]=eL,es[30]=en):en=es[30],en}function K(e){return(0,t.jsx)("option",{value:e.id,children:e.name},e.id)}e.s(["default",()=>D],93548)},66205,e=>{e.n(e.i(93548))}]);