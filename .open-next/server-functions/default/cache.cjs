globalThis.disableIncrementalCache = false;globalThis.disableDynamoDBCache = false;globalThis.isNextAfter15 = true;globalThis.openNextDebug = false;globalThis.openNextVersion = "3.9.12";
var b=Object.defineProperty;var N=Object.getOwnPropertyDescriptor;var P=Object.getOwnPropertyNames;var E=Object.prototype.hasOwnProperty;var R=(a,e)=>{for(var t in e)b(a,t,{get:e[t],enumerable:!0})},A=(a,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of P(e))!E.call(a,n)&&n!==t&&b(a,n,{get:()=>e[n],enumerable:!(i=N(e,n))||i.enumerable});return a};var B=a=>A(b({},"__esModule",{value:!0}),a);var L={};R(L,{SOFT_TAG_PREFIX:()=>h,default:()=>T});module.exports=B(L);function g(a){try{return"__openNextInternal"in a}catch{return!1}}function d(...a){globalThis.openNextDebug&&console.log(...a)}function v(...a){console.warn(...a)}var M=[{clientName:"S3Client",commandName:"GetObjectCommand",errorName:"NoSuchKey"}],S=a=>M.some(e=>e.clientName===a?.clientName&&e.commandName===a?.commandName&&(e.errorName===a?.error?.name||e.errorName===a?.error?.Code));function x(...a){if(a.some(e=>S(e)))return d(...a);if(a.some(e=>g(e))){let e=a.find(t=>g(t));return e.logLevel<O()?void 0:e.logLevel===0?console.log(...a.map(t=>g(t)?`${t.name}: ${t.message}`:t)):e.logLevel===1?v(...a.map(t=>g(t)?`${t.name}: ${t.message}`:t)):console.error(...a)}console.error(...a)}function O(){switch((process.env.OPEN_NEXT_ERROR_LOG_LEVEL??"1").toLowerCase()){case"debug":case"0":return 0;case"error":case"2":return 2;default:return 1}}async function u(a,e,t){if(globalThis.openNextConfig.dangerous?.disableTagCache)return!1;if(!t.value)return!0;if("type"in t&&t.type==="page")return!1;let n=t.lastModified??Date.now();return globalThis.tagCache.mode==="nextMode"?e.length===0?!1:await globalThis.tagCache.hasBeenRevalidated(e,n):await globalThis.tagCache.getLastModified(a,n)===-1}function y(a){if(!a)return[];try{let e=a.meta?.headers?.["x-next-cache-tags"]?.split(",")??[];return delete a.meta?.headers?.["x-next-cache-tags"],e}catch{return[]}}function D(a){return typeof a=="string"?a:JSON.stringify({tag:a.tag,path:a.path})}async function m(a){let e=globalThis.__openNextAls.getStore();if(d("Writing tags",a,e),!e||globalThis.openNextConfig.dangerous?.disableTagCache)return;let t=a.filter(i=>{let n=D(i),o=!e.writtenTags.has(n);return o&&e.writtenTags.add(n),o});t.length!==0&&await globalThis.tagCache.writeTags(t)}var F=new Set(["application/octet-stream","application/epub+zip","application/msword","application/pdf","application/rtf","application/vnd.amazon.ebook","application/vnd.ms-excel","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.openxmlformats-officedocument.wordprocessingml.document","font/otf","font/woff","font/woff2","image/bmp","image/gif","image/jpeg","image/png","image/tiff","image/vnd.microsoft.icon","image/webp","audio/3gpp","audio/aac","audio/basic","audio/flac","audio/mpeg","audio/ogg","audio/wavaudio/webm","audio/x-aiff","audio/x-midi","audio/x-wav","video/3gpp","video/mp2t","video/mpeg","video/ogg","video/quicktime","video/webm","video/x-msvideo","application/java-archive","application/vnd.apple.installer+xml","application/x-7z-compressed","application/x-apple-diskimage","application/x-bzip","application/x-bzip2","application/x-gzip","application/x-java-archive","application/x-rar-compressed","application/x-tar","application/x-zip","application/zip","application/x-protobuf"]);function w(a){if(!a)return!1;let e=a.split(";")[0];return F.has(e)}var h="_N_T_/";function I(a){return typeof a=="boolean"?a:typeof a=="object"?a.kindHint==="fetch"||a.fetchCache||a.kind==="FETCH":!1}var T=class{async get(e,t){if(globalThis.openNextConfig.dangerous?.disableIncrementalCache)return null;let i=typeof t=="object"?t.softTags:[],n=typeof t=="object"?t.tags:[];return I(t)?this.getFetchCache(e,i,n):this.getIncrementalCache(e)}async getFetchCache(e,t,i){d("get fetch cache",{key:e,softTags:t,tags:i});try{let n=await globalThis.incrementalCache.get(e,"fetch");if(n?.value===void 0)return null;let o=[...i??[],...t??[]],s=n.lastModified??Date.now();if(n.shouldBypassTagCache?!1:await u(e,o,n))return null;if((i??[]).length===0){let r=t?.find(c=>c.startsWith(h)&&!c.endsWith("layout")&&!c.endsWith("page"));if(r&&(n.shouldBypassTagCache?!1:await u(r.replace(h,""),[],n)))return null}return{lastModified:s,value:n.value}}catch(n){return d("Failed to get fetch cache",n),null}}async getIncrementalCache(e){try{let t=await globalThis.incrementalCache.get(e,"cache");if(!t?.value)return null;let i=t.value,n=i.meta,o=y(i),s=t.lastModified??Date.now();if(t.shouldBypassTagCache?!1:await u(e,o,t))return null;let r=globalThis.__openNextAls.getStore();if(r&&(r.lastModified=s),i?.type==="route")return{lastModified:s,value:{kind:globalThis.isNextAfter15?"APP_ROUTE":"ROUTE",body:Buffer.from(i.body??Buffer.alloc(0),w(String(n?.headers?.["content-type"]))?"base64":"utf8"),status:n?.status,headers:n?.headers}};if(i?.type==="page"||i?.type==="app"){if(globalThis.isNextAfter15&&i?.type==="app"){let c=new Map;if(i.segmentData)for(let[f,p]of Object.entries(i.segmentData??{}))c.set(f,Buffer.from(p));return{lastModified:s,value:{kind:"APP_PAGE",html:i.html,rscData:Buffer.from(i.rsc),status:n?.status,headers:n?.headers,postponed:n?.postponed,segmentData:c}}}return{lastModified:s,value:{kind:globalThis.isNextAfter15?"PAGES":"PAGE",html:i.html,pageData:i.type==="page"?i.json:i.rsc,status:n?.status,headers:n?.headers}}}return i?.type==="redirect"?{lastModified:s,value:{kind:"REDIRECT",props:i.props}}:(v("Unknown cache type",i),null)}catch(t){return d("Failed to get body cache",t),null}}async set(e,t,i){if(globalThis.openNextConfig.dangerous?.disableIncrementalCache)return;let n=globalThis.__openNextAls.getStore()?.pendingPromiseRunner.withResolvers();try{if(t==null)await globalThis.incrementalCache.delete(e);else{let o=this.extractRevalidateForSet(i);switch(t.kind){case"ROUTE":case"APP_ROUTE":{let{body:s,status:l,headers:r}=t;await globalThis.incrementalCache.set(e,{type:"route",body:s.toString(w(String(r["content-type"]))?"base64":"utf8"),meta:{status:l,headers:r},revalidate:o},"cache");break}case"PAGE":case"PAGES":{let{html:s,pageData:l,status:r,headers:c}=t;typeof l=="string"?await globalThis.incrementalCache.set(e,{type:"app",html:s,rsc:l,meta:{status:r,headers:c},revalidate:o},"cache"):await globalThis.incrementalCache.set(e,{type:"page",html:s,json:l,revalidate:o},"cache");break}case"APP_PAGE":{let{html:s,rscData:l,headers:r,status:c}=t;await globalThis.incrementalCache.set(e,{type:"app",html:s,rsc:l.toString("utf8"),meta:{status:c,headers:r},revalidate:o},"cache");break}case"FETCH":await globalThis.incrementalCache.set(e,t,"fetch");break;case"REDIRECT":await globalThis.incrementalCache.set(e,{type:"redirect",props:t.props,revalidate:o},"cache");break;case"IMAGE":break}}await this.updateTagsOnSet(e,t,i),d("Finished setting cache")}catch(o){x("Failed to set cache",o)}finally{n?.resolve()}}async revalidateTag(e){let t=globalThis.openNextConfig.dangerous;if(t?.disableTagCache||t?.disableIncrementalCache)return;let i=Array.isArray(e)?e:[e];if(i.length!==0)try{if(globalThis.tagCache.mode==="nextMode"){let n=await globalThis.tagCache.getPathsByTags?.(i)??[];await m(i),n.length>0&&await globalThis.cdnInvalidationHandler.invalidatePaths(n.map(o=>({initialPath:o,rawPath:o,resolvedRoutes:[{route:o,type:"app"}]})));return}for(let n of i){d("revalidateTag",n);let o=await globalThis.tagCache.getByTag(n);d("Items",o);let s=o.map(r=>({path:r,tag:n}));if(n.startsWith(h))for(let r of o){let f=(await globalThis.tagCache.getByPath(r)).filter(p=>!p.startsWith(h));for(let p of f){let C=await globalThis.tagCache.getByTag(p);d({hardTag:p,_paths:C}),s.push(...C.map(_=>({path:_,tag:p})))}}await m(s);let l=Array.from(new Set(s.filter(r=>r.tag.startsWith(h)).map(r=>`/${r.path}`)));l.length>0&&await globalThis.cdnInvalidationHandler.invalidatePaths(l.map(r=>({initialPath:r,rawPath:r,resolvedRoutes:[{route:r,type:"app"}]})))}}catch(n){x("Failed to revalidate tag",n)}}async updateTagsOnSet(e,t,i){if(globalThis.openNextConfig.dangerous?.disableTagCache||globalThis.tagCache.mode==="nextMode"||!t)return;let n=t?.kind==="FETCH"?i?.tags??t?.data?.tags??[]:t?.kind==="PAGE"?t.headers?.["x-next-cache-tags"]?.split(",")??[]:[];d("derivedTags",n);let o=await globalThis.tagCache.getByPath(e),s=n.filter(l=>!o.includes(l));s.length>0&&await m(s.map(l=>({path:e,tag:l,revalidatedAt:1})))}extractRevalidateForSet(e){if(e!==void 0){if(typeof e=="number"||e===!1)return e;if("revalidate"in e)return e.revalidate;if("cacheControl"in e)return e.cacheControl?.revalidate}}};0&&(module.exports={SOFT_TAG_PREFIX});
